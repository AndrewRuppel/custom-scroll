/*
 * jQuery Custom Scroll plugin
 * https://github.com/standys/custom-scroll
 *
 * Copyright 2014, Mostovoy Andrey
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
!function(o){function t(t,r){function e(){var o=0|c.prop("scrollHeight"),e=t.innerHeight(),a=Math.max(e*e/o|0,r.barMinHeight),n=(e-a)/(o-e);return{ratio:n,height:e,heightTotal:o,barHeight:a}}function a(){var o=e();s&&s.height===o.height&&s.heightTotal===o.heightTotal||(d.toggleClass(i("hidden"),o.barHeight>=o.height),s=o);var t=c.scrollTop(),a=t*o.ratio;r.doWrap||(a+=t),0>a&&(a=0),r.doWrap&&a>o.height-o.barHeight&&(a=o.height-o.barHeight),d.height(o.barHeight).css("top",a)}function n(){h.remove(),t.removeClass(i("container")).removeData("custom-scroll"),r.doWrap?(c.contents().appendTo(t),c.remove()):t.removeClass(i("dont-wrap"))}function i(o){return r.prefix+o}r=o.extend({},o.fn.customScroll.defaultOptions,r);var s;if(t.hasClass(i("container"))){var l=t.data("custom-scroll");return l.updateBar(),l}if(t.addClass(i("container")),r.doWrap){t.wrapInner('<div class="'+i("inner")+'"></div>');var c=t.children()}else t.addClass(i("dont-wrap")),c=t;var u=null!=r.barHtml?r.barHtml:'<div class="'+i("bar")+" "+i("hidden")+'"></div>',h=o(u);t.append(h);var d=h.last(),p=o("body");d.on("mousedown",function(o){var t=c.scrollTop(),r=o.clientY,a=e().ratio;p.on("mousemove.custom-scroll",function(o){o.stopPropagation(),o.preventDefault();var e=o.clientY-r,n=t+e/a;c.scrollTop(n)}),p.on("mouseup.custom-scroll",function(){p.off("mousemove.custom-scroll"),p.off("mouseup.custom-scroll")})}),c.on("scroll",a),a();var m={$container:t,$bar:d,$inner:c,destroy:n,updateBar:a};return t.data("custom-scroll",m),m}o.fn.customScroll=function(r){return"destroy"===r?void this.each(function(){var t=o(this).data("custom-scroll");t&&t.destroy()}):1===this.length?t(this,r):void this.each(function(){t(o(this),r)})},o.fn.customScroll.defaultOptions={prefix:"custom-scroll_",barMinHeight:10,barHtml:null,doWrap:!0}}(jQuery);